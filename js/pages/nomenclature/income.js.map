{"version":3,"sources":["pages/nomenclature/income.ts"],"names":[],"mappings":"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","file":"income.js","sourcesContent":["import api from \"../../api\";\nimport incomeTemplate from '/income_template.html!text';\nimport app from \"../../application\";\nimport {findSelectById} from \"../../ui/select\";\n\nlet contractorsSelect = null;\nlet agreementsSelect = null;\nlet addRow = null;\nlet container = null;\nlet counter = 0;\n\nexport default function nomenclatureIncome () {\n    // contractorsSelect = document.querySelector('#contractor_select');\n    // agreementsSelect = document.querySelector('#agreement_select');\n    addRow = document.querySelector('#addRow');\n    container = document.querySelector('.income-container');\n\n    addRow.addEventListener('click', addRowEventListener);\n\n    let contractorSelect = findSelectById('contractor_select');\n    let agreementSelect = findSelectById('agreements_select');\n\n    contractorSelect.addOnChangeEventListener(function (contractor) {\n\n        agreementSelect.processItems(contractor.metadata.agreements.map(function (i) {\n            return {\n                text: i.from + ' - ' + i.until,\n                value: i.id,\n                isSelected: false\n            };\n        }));\n        agreementSelect.setPlaceholderText();\n    });\n}\n\nfunction contractorChangeEventListener () {\n    while (agreementsSelect.firstElementChild) {\n        agreementsSelect.removeChild(agreementsSelect.firstElementChild);\n    }\n\n    api.get('/api/contractor/' + contractorsSelect.value)\n        .then(response => response.json())\n        .then(response => populateAgreementsSelect(response));\n}\n\nfunction populateAgreementsSelect (data:any) {\n    for (let i = 0; i < data.agreements.length; i++) {\n        let option = document.createElement('option');\n        option.setAttribute('value', data.agreements[i].id);\n        option.innerHTML = data.agreements[i].from + ' - ' + data.agreements[i].until;\n\n        agreementsSelect.appendChild(option);\n    }\n}\n\nfunction addRowEventListener () {\n    let temp:any = document.createElement('div');\n    let tmp = incomeTemplate as string;\n    while (tmp.indexOf('{i}') > -1) {\n        tmp = tmp.replace(\"{i}\" as any, counter.toString());\n    }\n    temp.innerHTML = tmp;\n\n\n    let table = temp.firstElementChild;\n    container.appendChild(table);\n\n    let tableBody = table.querySelector('tbody');\n    let addBatch = table.querySelector('.add-batch');\n    let deleteNomenclature = table.querySelector('[data-delete-nomenclature]');\n\n    addBatch.addEventListener('click', function () {\n        let _temp = document.createElement('tbody');\n        let rowTemplate = this.temp.querySelector('template#batch_row').innerHTML;\n\n        while (rowTemplate.indexOf('{row}') > -1) {\n            rowTemplate = rowTemplate.replace(\"{row}\" as any, this.rows.toString());\n        }\n\n        this.rows++;\n\n        _temp.innerHTML = rowTemplate;\n        let row = _temp.firstElementChild;\n        this.body.appendChild(row);\n\n        row.querySelector('[data-price]').addEventListener('input', recalculate.bind(row));\n        row.querySelector('[data-amount]').addEventListener('input', recalculate.bind(row));\n        row.querySelector('[data-nds]').addEventListener('input', recalculate.bind(row));\n\n        row.querySelector('[data-delete-row]').addEventListener('click', function () {\n            let row = this.parentElement.parentElement;\n            row.parentElement.removeChild(row);\n        });\n    }.bind({\n        temp: temp,\n        body: tableBody,\n        rows: 0\n    }));\n\n    deleteNomenclature.addEventListener('click', function () {\n        let row = this.parentElement.parentElement.parentElement.parentElement.parentElement;\n        row.parentElement.removeChild(row);\n    });\n\n    app.callEmmitable('select');\n\n    // todo: оптимизировать: передавать источник события?\n\n    counter++;\n}\n\nfunction recalculate() {\n    let target = this.querySelector('[data-total]');\n    let targetInput = this.querySelector('[data-total-input]');\n    let price = this.querySelector('[data-price]').value;\n    let amount = this.querySelector('[data-amount]').value;\n    let nds:any = this.querySelector('[data-nds]').value;\n\n    nds /= 100;\n    nds += 1;\n\n    // debugger;\n\n    let total = Number(price) * Number(amount) * nds;\n    if (!isNaN(total)) {\n        target.innerHTML = total.toFixed(2);\n        targetInput.value = total.toFixed(2);\n\n    }\n}\n"]}