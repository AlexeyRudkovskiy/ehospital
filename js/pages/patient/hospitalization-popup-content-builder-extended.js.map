{"version":3,"sources":["pages/patient/hospitalization-popup-content-builder-extended.ts"],"names":[],"mappings":"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","file":"hospitalization-popup-content-builder-extended.js","sourcesContent":["import {ContentBuilder} from \"../../ui/popup/content-builder\";\nimport { Form, WrapperInfo, ElementInfo } from \"../../ui/form\"\nimport app from \"../../application\"\nimport laroute from '/js/laroute.js'\nimport lang from \"../../lang\";\nimport {findSelectById, SelectContainer} from \"../../ui/select\";\n\nexport default class HospitalizationPopupContentBuilderExtended implements ContentBuilder {\n\n    private name:any = null;\n\n    private measure:any = null;\n\n    private originName:any = null;\n\n    private initialData:any = null;\n\n    private nomenclatureContainer:any = null;\n\n    private unitContainer:any = null;\n\n    private setContainer:any = null;\n\n    public popup:any;\n\n    build(data: any): any {\n        let body = document.createElement('div');\n        let form = document.createElement('form');\n\n        this.initialData = data || {\n            name: '',\n            measure: '',\n            nomenclature_id: '',\n            unit_id: '',\n            amount: '',\n            originName: '',\n            is_set: false,\n            set_id: -1\n        };\n\n        if (typeof this.initialData.originName !== \"undefined\" && this.initialData.originName.length < 1) {\n            this.initialData.originName = this.initialData.name;\n        } else if (typeof this.initialData.originName === \"undefined\") {\n            this.initialData.originName = this.initialData.name;\n        }\n\n        form.classList.add('form');\n        form.setAttribute('method', 'post');\n        form.setAttribute('action', '#');\n\n        let medicamentName = Form.likeInput('Медикамент', data.name);\n        let medicamentAmount = Form.likeInput('Колличество', data.measure);\n        let amount = Form.number('Колличество', 'amount', {}, this.initialData.amount);\n\n        if (this.initialData.originName !== this.initialData.name) {\n            (medicamentName.element as any).innerHTML = this.initialData.name + ' (' + this.initialData.originName + ')';\n        }\n\n        if (typeof this.initialData.amount !== \"undefined\" && this.initialData.amount.length > 0) {\n            (medicamentAmount.element as any).innerHTML = this.initialData.amount + ' (' + this.initialData.measure + ')';\n        }\n\n        let measureInput = Form.hidden('measure', this.initialData.measure);\n        let nameInput = Form.hidden('name', this.initialData.name);\n        let originName = Form.hidden('origin_name', this.initialData.originName);\n\n        this.originName = originName.element;\n        this.name = nameInput.element;\n\n        let nomenclatureSelectArguments = {\n            id: 'nomenclature_select',\n            'data-title': 'Номенклатуры',\n            'data-subtitle': \"Выберите номенклатуру\",\n            'data-search': laroute.route('search.nomenclatures') + \"?sets_link=1\",\n            'data-search-alias': laroute.route('search.nomenclatures'),\n            'data-search-placeholder': 'Введите фразу для поиска номенклатур',\n            'data-empty': lang.get('global.select.empty')\n        };\n\n        let departmentId = (window as any).department.id;\n\n        let setSelectArguments = {\n            'id': 'set_select',\n            'data-title': 'Наборы',\n            'data-subtitle': \"Выберите набор\",\n            'data-search': laroute.route('search.sets', { department: departmentId }),\n            'data-search-alias': laroute.route('search.sets', { department: 0 }),\n            'data-search-placeholder': 'Введите фразу для поиска наборп',\n            'data-empty': lang.get('global.select.empty')\n        };\n\n        if (!this.initialData.is_set && typeof this.initialData.nomenclature_id !== \"undefined\" && this.initialData.nomenclature_id !== '') {\n            nomenclatureSelectArguments['data-preload'] = laroute.route('search.nomenclature', {\n                nomenclature: this.initialData.nomenclature_id\n            }) + '?unit_id=' + this.initialData.unit_id;\n        }\n\n        if (this.initialData.is_set && typeof this.initialData.set_id !== \"undefined\" && this.initialData.set_id !== '') {\n            setSelectArguments['data-preload'] = laroute.route('search.sets_default', {\n                department: departmentId\n            }) + '?set_id=' + this.initialData.set_id;\n        }\n\n        let nomenclatureSelect = Form.select('Номенклатура', 'nomenclature_id', [], nomenclatureSelectArguments);\n        let setSelect = Form.select('Набор', 'set', [], setSelectArguments);\n\n        let unitSelect = Form.select('Единица измерения', 'unit_id', [], {\n            id: 'unit_select',\n            'data-title': 'Единицы измерения',\n            'data-subtitle': \"Выберите единицу измерения\",\n            'data-search-alias': laroute.route('search.units'),\n            'data-empty': lang.get('global.select.empty')\n        });\n\n        let useSetInsteadOfNomenclature = Form.checkbox(\n            lang.get('ui.hospitalization.popup.use_set_instead_of_nomenclature'),\n            'use_set_instead_of_nomenclature',\n            'yes',\n            true\n        );\n\n        useSetInsteadOfNomenclature.element.addEventListener('change', this.onCheckboxChanged.bind({\n            instance: this,\n            element: useSetInsteadOfNomenclature.element\n        }));\n\n        form.appendChild(medicamentName.container);\n        form.appendChild(medicamentAmount.container);\n        form.appendChild(useSetInsteadOfNomenclature.container);\n        form.appendChild(nomenclatureSelect.container);\n        form.appendChild(unitSelect.container);\n        form.appendChild(setSelect.container);\n        form.appendChild(amount.container);\n        form.appendChild(measureInput.container);\n        form.appendChild(nameInput.container);\n        form.appendChild(originName.container);\n\n        setSelect.container.classList.add('hide');\n\n        body.appendChild(form);\n\n        this.nomenclatureContainer = nomenclatureSelect.container;\n        this.unitContainer = unitSelect.container;\n        this.setContainer = setSelect.container;\n\n        if (this.initialData.is_set) {\n            setSelect.container.classList.remove('hide');\n            nomenclatureSelect.container.classList.add('hide');\n            unitSelect.container.classList.add('hide');\n\n            (useSetInsteadOfNomenclature.element as HTMLInputElement).checked = true;\n        }\n\n        return body;\n    }\n\n    public onPopupAppeared () {\n        app.callEmmitable('select');\n\n        let nomenclatureSelectContainer:SelectContainer = findSelectById('nomenclature_select');\n        let unitSelectContainer:SelectContainer = findSelectById('unit_select');\n        let setSelectContainer:SelectContainer = findSelectById('set_select');\n\n        nomenclatureSelectContainer.addOnChangeEventListener(function (nomenclature) {\n            this.unitSelect.processItems(nomenclature.metadata.units);\n            this.unitSelect.setPlaceholderText();\n\n            this.instance.name.value = nomenclature.text;\n        }.bind({\n            unitSelect: unitSelectContainer,\n            instance: this\n        }));\n\n        setSelectContainer.addOnChangeEventListener(function (set) {\n            this.name.value = set.text;\n        }.bind(this));\n    }\n\n    private onCheckboxChanged () {\n        (this as any).instance.nomenclatureContainer.classList.toggle('hide');\n        (this as any).instance.unitContainer.classList.toggle('hide');\n        (this as any).instance.setContainer.classList.toggle('hide');\n    }\n\n}"]}