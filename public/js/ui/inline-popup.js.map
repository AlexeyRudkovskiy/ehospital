{"version":3,"sources":["ui/inline-popup.ts"],"names":[],"mappings":"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","file":"ui/inline-popup.js","sourcesContent":["export class InlinePopup {\n\n    protected static element:any = null;\n\n    protected root:any;\n\n    protected pageMargins:number = 15;\n\n    protected onLoadedFunc:any = null;\n\n    constructor (\n        private target:any,\n        private content:string,\n        private ajax:boolean = false,\n        private config:any = {}\n    ) {\n        if (typeof config['maxWidth'] === \"undefined\") {\n            this.config['maxWidth'] = 300;\n        }\n    }\n\n    public setOnLoadedEventListener(func:any):InlinePopup {\n        this.onLoadedFunc = func;\n        return this;\n    }\n\n    public show():InlinePopup {\n        if (InlinePopup.element != null && InlinePopup.element.parentElement != null) {\n            this.close();\n        }\n\n        if (this.ajax) {\n            var request = (<any>window).fetch(this.content, {\n                credentials: 'same-origin',\n                headers: {\n                    token: (<any>window).token\n                }\n            })\n                .then(response => response.text())\n                .then(this.onContentLoaded.bind(this));\n        }\n\n        return this;\n    }\n\n    public close():void {\n        if (InlinePopup.element != null && InlinePopup.element.parentElement != null) {\n            InlinePopup.element.parentElement.removeChild(InlinePopup.element);\n        }\n    }\n\n    private onContentLoaded (response) {\n        var offsetTop = this.target.offsetTop;\n        var offsetLeft = this.target.offsetLeft;\n        var offsetWidth = this.target.offsetWidth;\n        var offsetHeight = this.target.offsetHeight;\n\n        var popup = document.createElement('div');\n        var popupContent = document.createElement('div');\n        var popupClose = document.createElement('div');\n        var popupTriangle = document.createElement('div');\n\n        popup.classList.add('inline-popup');\n        popupClose.classList.add('inline-popup-close');\n        popupContent.classList.add('inline-popup-content');\n        popupTriangle.classList.add('inline-popup-triangle');\n\n        popup.appendChild(popupContent);\n        popup.appendChild(popupClose);\n        popup.appendChild(popupTriangle);\n\n        popupContent.innerHTML = response;\n\n        InlinePopup.element = popup;\n        document.querySelector('.container .content').appendChild(popup);\n\n        popup.style.top = \"0px\";\n        popup.style.left = \"0px\";\n\n        this.root = popupContent;\n\n        if (popup.offsetWidth > this.config.maxWidth) {\n            var maxWidth = this.config.maxWidth;\n            popup.style.width = maxWidth + 'px';\n        }\n\n        popup.style.top = (offsetTop + offsetHeight) + \"px\";\n        var popupLeftPosition = offsetLeft - popup.offsetWidth / 2;\n\n        /*\n         * Отступ от правой границы\n         * Добавляет отступ что бы окно выглядело красивее\n         */\n        var popupRightWindowBorderOffset = 25;\n        var triangleOffset = 17;\n        if (popupLeftPosition + popup.offsetWidth > window.innerWidth - popupRightWindowBorderOffset) {\n            popupLeftPosition = window.innerWidth - popup.offsetWidth - popupRightWindowBorderOffset;\n            triangleOffset = 13;\n        } else {\n            popupLeftPosition += popupRightWindowBorderOffset;\n        }\n\n        popup.style.left = (popupLeftPosition) + 'px';\n\n        var triangleDiff = Math.abs(popupLeftPosition - offsetLeft);\n\n        popupTriangle.style.left = (triangleDiff) + \"px\";\n        popupTriangle.style.marginLeft = (triangleOffset) + \"px\";\n\n        if (this.onLoadedFunc != null) {\n            this.onLoadedFunc.call(window, this.root, this);\n        }\n    }\n\n}"],"sourceRoot":"/source/"}